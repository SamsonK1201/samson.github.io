<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farming Simulator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body {
      padding: 0;
      margin: 0;
      overflow: hidden;
    }

    ::selection {
      background-color: transparent;
    }

    #shop {
      position: absolute;
      color: white;
      top: 2%;
      right: 1%;
    }

    button {
      font-size: 30px;
      font-family: 'Courier New', Courier, monospace;
      font-style: bold;
      border-radius: 10px;
    }

    #stats {
      display: flex;
      flex-direction: column;
      left: 2%;
      width: 30%;
      position: absolute;
    }

    .statsdiv {
      width: 100%;
      margin-top: -30px;
    }

    h2 {
      color: white;
    }
  </style>
</head>

<body>
  <div id="stats">
    <div id="statsdiv1">
      <h2 id="money"></h2>
    </div>
    <div class="statsdiv">
      <h2 id="EXP"></h2>
    </div>
    <div class="statsdiv">
      <h2 id="placeholder"></h2>
    </div>
  </div>
  <div id="shop">
    <button onclick="shop()">Shop</button>
  </div>
</body>
<script>
  /*TO DO LIST: PLS DO
  FIX CROP OVERLAP
  */
  let windowW = window.innerWidth
  let windowH = window.innerHeight
  // Define variables
  //crops
  let crops = [];
  let wheat
  let sugarcane
  let corn
  let sorghum
  let canola
  let sunflower
  let soybean
  let ableToCrop = true
  let lastClickTime = 0
  let delay = 350
  //player
  let farmer
  let prestigeProfit = 1
  let prestigeCost = 1
  let level = 1
  let sugarcaneBought = 0
  let speed = 5
  let savedMoney = 1000 
  let savedEXP = 200
  //size of farmer
  let farmerX = windowW / 2
  let farmerY = windowH / 2
  let farmerL = 200
  let farmerW = 200

  function shop() {
    window.location.href = "VideoGameProjectShopPage.html"
  }

  function preload() {
    //load all images
    wheat = loadImage('wheat (2).png')
    sugarcane = loadImage('sugarcane (2).png')
    corn = loadImage('corn (2).png')
    sorghum = loadImage('sorghum (2).png')
    canola = loadImage('canola (2).png')
    sunflower = loadImage('sunflower (2).png')
    soybean = loadImage('soybean (2).png')
    farmer = loadImage('farmer.png')
    bg = loadImage('dirtbg.png')
  }

  function saveData() {
    localStorage.setItem('money', savedMoney)
    localStorage.setItem('exp', savedEXP)
  }

  function loadGameState() {
    if (localStorage.getItem('money')) {
      savedMoney = parseFloat(localStorage.getItem('money'))
      console.log("RAN 100")
    }
    if (localStorage.getItem('exp')) {
      savedEXP = parseFloat(localStorage.getItem('exp'))
    }
    
  }

  function setup() {
    createCanvas(windowW, windowH);
    // Plant initial crops
    for (let i = 0; i < 5; i++) {
      let x = random(width / 1.5);
      let y = random(height / 1.5);
      crops.push(new Wheat(x, y));
    }
    loadGameState()
  }

  window.onload = function (){
    localStorage.getItem('sugarcaneBought')
    
  }

  function draw() {
    clear()
    imageMode(CORNER)
    background(bg);
    saveData()

    // Display money
    document.getElementById('money').innerText = "Money: $" + savedMoney
    document.getElementById('EXP').innerText = "Exp: " + savedEXP

    //Display how much until next upgrade
    if (level == 1) {
      document.getElementById('placeholder').innerText = "Next Upgrade: $1,500 & 300 Exp"
      localStorage.setItem('level', level)
    }
    if (level == 2) {
      document.getElementById('placeholder').innerText = "Next Upgrade: $4,500 & 1,000 Exp"
    }
    if (level == 3) {
      document.getElementById('placeholder').innerText = "Next Upgrade: $7,500 & 2,000 Exp"
    }
    if (level == 4) {
      document.getElementById('placeholder').innerText = "Next Upgrade: $11,000 & 4,000 Exp"
    }
    if (level == 5) {
      document.getElementById('placeholder').innerText = "Next Upgrade: $16,000 & 6,000 Exp"
    }
    if (level == 6) {
      document.getElementById('placeholder').innerText = "Next Upgrade: $25,000 & 10,000 Exp"
    }

    // Display crops
    for (let crop of crops) {
      crop.show();
    }

    // Update and grow crops
    for (let crop of crops) {
      crop.grow();
    }

    // Harvest mature crops
    for (let i = crops.length - 1; i >= 0; i--) {
      if (crops[i].isMature()) {
        savedMoney += crops[i].harvest();
        savedEXP += crops[i].exp()
        crops.splice(i, 1);
      }
    }

    //max 10 crops
    if (crops.length < 15) {
      ableToCrop = true
    }
    else {
      ableToCrop = false
    }

    //player move
    imageMode(CENTER)
    image(farmer, farmerX, farmerY, farmerL, farmerW)

    //check if user is holding left arrow or A AND that the location of the farmer does not exceed the right margin
    if (keyIsDown(65) == true || keyIsDown(LEFT_ARROW)) {
      if (farmerX > 0 - farmerL) {
        farmerX -= speed;
      }
    }

    if (keyIsDown(65) == true || keyIsDown(LEFT_ARROW)) {
      if (farmerX <= 0 - farmerL) {
        farmerX += windowW + farmerL
      }
    }

    //check if user is holding right arrow or D AND that the location of the farmer does not exceed the right margin
    if (keyIsDown(68) == true || keyIsDown(RIGHT_ARROW)) {
      if (farmerX < windowW + farmerL) {
        farmerX += speed;
      }
    }

    if (keyIsDown(68) == true || keyIsDown(RIGHT_ARROW)) {
      if (farmerX >= windowW + farmerL / 2) {
        farmerX -= windowW + farmerL / 2
      }
    }

    //check if user is holding up arrow or W AND that the location of the farmer does not exceed the top margin
    if (keyIsDown(87) == true || keyIsDown(UP_ARROW)) {
      if (farmerY > 0 - farmerW / 2) {
        farmerY -= speed;
      }
    }

    if (keyIsDown(87) == true || keyIsDown(UP_ARROW)) {
      if (farmerY + 200 <= farmerW / 2) {
        farmerY += windowH + farmerW / 2
      }
    }

    //check if user is holding down arrow or S AND that the location of the farmer does not exceed the bottom margin
    if (keyIsDown(83) == true || keyIsDown(DOWN_ARROW)) {
      if (farmerY < windowH + farmerW / 2) {
        farmerY += speed;
      }
    }

    if (keyIsDown(83) == true || keyIsDown(DOWN_ARROW)) {
      if (farmerY >= windowH + farmerW / 2) {
        farmerY -= windowH + farmerW / 2;
      }
    }
  }

  //plant crops when mouse is pressed
  function mousePressed() {
    let currentTime = millis()
    if (currentTime - lastClickTime > delay) {
      lastClickTime = currentTime
      if (ableToCrop == true) {
        //Wheat
        if (savedMoney >= 10 && savedEXP >= 0) {
          if (savedMoney < 1500 || savedEXP <= 300) {
            let x = farmerX + 20;
            let y = farmerY - 20;
            crops.push(new Wheat(x, y));
            savedMoney -= 10;
          }
        }

        //Sugarcane
          if (savedMoney > 1500 && savedEXP >= 300) {
            if (savedMoney < 4500 || savedEXP <= 1000) {
            let x = farmerX + 20;
            let y = farmerY - 20;
            crops.push(new Sugarcane(x, y))
            savedMoney -= 25
            level = 2
            }
          }
          
        //Corn
        if (savedMoney > 4500 && savedEXP >= 1000) {
          if (savedMoney < 7500 || savedEXP <= 2000) {
            let x = farmerX + 20;
            let y = farmerY - 20;
            crops.push(new Corn(x, y))
            savedMoney -= 40
            level = 3
          }
        }

        //Sorghum
        if (savedMoney > 7500 && savedEXP >= 2000) {
          if (savedMoney < 11000 || savedEXP <= 4000) {
            let x = farmerX + 20;
            let y = farmerY - 20;
            crops.push(new Sorghum(x, y))
            savedMoney -= 60
            level = 4
          }
        }

        //Canola
        if (savedMoney > 11000 && savedEXP >= 4000) {
          if (savedMoney < 16000 || savedEXP <= 6000) {
            let x = farmerX + 20;
            let y = farmerY - 20;
            crops.push(new Canola(x, y))
            savedMoney -= 80
            level = 5
          }
        }

        //Sunflower 
        if (savedMoney > 16000 && savedEXP >= 6000) {
          if (savedMoney < 25000 || savedEXP <= 10000) {
            let x = farmerX + 20;
            let y = farmerY - 20;
            crops.push(new Sunflower(x, y))
            savedMoney -= 100
            level = 6
          }
        }

        //Soybean
        if (savedMoney > 25000 && savedEXP >= 10000) {
          if (savedMoney < 45000 || savedEXP <= 20000) {
            let x = farmerX + 20;
            let y = farmerY - 20;
            crops.push(new Soybean(x, y))
            savedMoney -= 140
            level = 7
          }
        }
      }
    }


    /*if (money > 30000 && exp >= 40000){
      //rebirth
    }*/
  }

  class Wheat {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.age = 0;
      this.harvested = false;
    }

    grow() {
      if (!this.harvested) {
        this.age++;
      }
    }

    isMature() {
      return this.age >= 100;
    }

    harvest() {
      this.harvested = true;
      return Math.floor(random(15, 30));
    }

    show() {
      if (!this.harvested) {
        image(wheat, this.x, this.y, 100, 100);
      }
    }

    exp() {
      if (this.harvested = true) {
        return Math.floor(random(1, 3))
      }
    }

  }

  class Sugarcane {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.age = 0;
      this.harvested = false;
    }

    grow() {
      if (!this.harvested) {
        this.age++;
      }
    }

    isMature() {
      return this.age >= 125;
    }

    harvest() {
      this.harvested = true;
      return Math.floor(random(30, 45));
    }

    show() {
      if (!this.harvested) {
        image(sugarcane, this.x, this.y, 100, 100);
      }
    }

    exp() {
      if (this.harvested = true) {
        return Math.floor(random(3, 6))
      }
    }
  }

  class Corn {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.age = 0;
      this.harvested = false;
    }

    grow() {
      if (!this.harvested) {
        this.age++;
      }
    }

    isMature() {
      return this.age >= 150;
    }

    harvest() {
      this.harvested = true;
      return Math.floor(random(45, 60));
    }

    show() {
      if (!this.harvested) {
        image(corn, this.x, this.y, 100, 100);
      }
    }

    exp() {
      if (this.harvested = true) {
        return Math.floor(random(6, 8))
      }
    }
  }

  class Sorghum {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.age = 0;
      this.harvested = false;
    }

    grow() {
      if (!this.harvested) {
        this.age++;
      }
    }

    isMature() {
      return this.age >= 175;
    }

    harvest() {
      this.harvested = true;
      return Math.floor(random(60, 80));
    }

    show() {
      if (!this.harvested) {
        image(sorghum, this.x, this.y, 100, 100);
      }
    }

    exp() {
      if (this.harvested = true) {
        return Math.floor(random(8, 10))
      }
    }
  }

  class Canola {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.age = 0;
      this.harvested = false;
    }

    grow() {
      if (!this.harvested) {
        this.age++;
      }
    }

    isMature() {
      return this.age >= 200;
    }

    harvest() {
      this.harvested = true;
      return Math.floor(random(80, 100));
    }

    show() {
      if (!this.harvested) {
        image(canola, this.x, this.y, 100, 100);
      }
    }

    exp() {
      if (this.harvested = true) {
        return Math.floor(random(10, 12))
      }
    }
  }

  class Sunflower {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.age = 0;
      this.harvested = false;
    }

    grow() {
      if (!this.harvested) {
        this.age++;
      }
    }

    isMature() {
      return this.age >= 250;
    }

    harvest() {
      this.harvested = true;
      return Math.floor(random(100, 140));
    }

    show() {
      if (!this.harvested) {
        image(sunflower, this.x, this.y, 100, 100);
      }
    }

    exp() {
      if (this.harvested = true) {
        return Math.floor(random(12, 15))
      }
    }
  }

  class Soybean {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.age = 0;
      this.harvested = false;
    }

    grow() {
      if (!this.harvested) {
        this.age++;
      }
    }

    isMature() {
      return this.age >= 350;
    }

    harvest() {
      this.harvested = true;
      return Math.floor(random(140, 180));
    }

    show() {
      if (!this.harvested) {
        image(soybean, this.x, this.y, 100, 100);
      }
    }

    exp() {
      if (this.harvested = true) {
        return Math.floor(random(15, 20))
      }
    }
  }

</script>

</html>